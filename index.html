<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vizerio - YÃ¶netim Paneli</title>
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="css/style.css">

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div id="loading-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; background:#f3f4f6; display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999;">
        <h2 style="color:#1e293b; font-family:'Inter',sans-serif; margin:0;">Vizerio</h2>
        <p style="color:#64748b; margin-top:10px;">Sistem BaÅŸlatÄ±lÄ±yor...</p>
    </div>

    <div class="sidebar-overlay" id="sidebar-overlay" onclick="ui.toggleSidebar()"></div>

    <div class="app-container" style="display:none;" id="main-app">
        
        <aside class="sidebar" id="sidebar">
            <div class="logo-area"><h2>VIZERIO</h2><span>Office v3.5</span></div>
            <nav class="menu">
                <div class="menu-item active" id="nav-finance" onclick="app.switchTab('finance')">
                    <span class="material-icons-round">account_balance_wallet</span>
                    <span class="menu-item-text">Finans</span>
                </div>
                <div class="menu-item" id="nav-crm" onclick="app.switchTab('crm')">
                    <span class="material-icons-round">people</span>
                    <span class="menu-item-text">Operasyon</span>
                </div>
                <div class="menu-item text-red" style="margin-top: auto;" onclick="window.auth.logout()">
                    <span class="material-icons-round">logout</span>
                    <span class="menu-item-text">Ã‡Ä±kÄ±ÅŸ</span>
                </div>
            </nav>
        </aside>

        <main class="main-content">
            <header class="top-header">
                <div class="header-left">
                    <button class="toggle-btn" onclick="ui.toggleSidebar()">
                        <span class="material-icons-round">menu</span>
                    </button>
                    <div class="search-bar"><span class="material-icons-round">search</span><input type="text" placeholder="Ara..."></div>
                </div>
                <div class="header-tools">
                    <div style="font-size:12px; font-weight:600; color:#64748b; background:#f1f5f9; padding:5px 10px; border-radius:6px;" id="live-rates-display">Kurlar YÃ¼kleniyor...</div>
                </div>
            </header>

            <section id="section-finance" class="content-section active">
                
                <div style="background:white; border-radius:12px; margin-bottom:20px; border:1px solid #e2e8f0; padding:20px;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px; flex-wrap:wrap; gap:10px;">
                        <h2 style="margin:0; font-size:18px;">Kasa VarlÄ±klarÄ±</h2>
                        <div style="display:flex; gap:10px;">
                            <button class="btn btn-green" onclick="ui.openModal('modal-select-income-type')" style="width:auto; padding:8px 15px;">Gelir</button>
                            <button class="btn btn-red" onclick="ui.openModal('modal-expense')" style="width:auto; padding:8px 15px;">Gider</button>
                            <button class="btn" style="background:#6366f1; color:white; width:auto; padding:8px 15px;" onclick="ui.openModal('modal-exchange')">Kur</button>
                        </div>
                    </div>
                    <div class="wallet-grid">
                        <div class="wallet-item"><span class="wallet-label">TL KASA</span><div class="wallet-amount" style="color:#1e293b;" id="wallet-try">â‚º 0</div></div>
                        <div class="wallet-item"><span class="wallet-label">USD KASA</span><div class="wallet-amount" style="color:#15803d;" id="wallet-usd">$ 0</div><small class="wallet-sub" id="val-usd">â‰ˆ â‚º0</small></div>
                        <div class="wallet-item"><span class="wallet-label">EUR KASA</span><div class="wallet-amount" style="color:#0369a1;" id="wallet-eur">â‚¬ 0</div><small class="wallet-sub" id="val-eur">â‰ˆ â‚º0</small></div>
                        <div class="wallet-item"><span class="wallet-label">TOPLAM VARLIK (TL)</span><div class="wallet-amount" style="color:#4f46e5;" id="total-equity">â‚º 0</div></div>
                    </div>
                </div>

                <div class="summary-cards">
                    <div class="card card-clickable border-green" onclick="accounting.toggleChartData('profit', this)"><div class="card-title">NET KÃ‚R (AÃ‡IK)</div><div class="money" id="money-profit">0</div></div>
                    <div class="card card-clickable border-blue" onclick="accounting.toggleChartData('income', this)"><div class="card-title">TOPLAM CÄ°RO (AÃ‡IK)</div><div class="money" id="money-income">0</div></div>
                    <div class="card card-clickable border-red" onclick="accounting.toggleChartData('expense', this)"><div class="card-title">TOPLAM GÄ°DER (AÃ‡IK)</div><div class="money" id="money-expense">0</div></div>
                    <div class="card border-orange" style="cursor: pointer;" ondblclick="if(window.accounting) accounting.openEscrowDetails()"><div class="card-title">EMANET (Ã‡Ä°FT TIKLA)</div><div class="money" id="money-escrow">0</div></div>
                </div>

               <div class="chart-table-wrapper">
                    
                    <div class="card" style="padding: 20px; min-height: 400px; margin-bottom: 20px;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; flex-wrap:wrap; gap:10px;">
                            <div style="display:flex; align-items:center; gap:10px;">
                                <h4 style="margin:0; color:#64748b;">FÄ°NANSAL ANALÄ°Z</h4>
                                <select id="chart-currency" onchange="accounting.refreshDashboard()" style="padding:4px; border-radius:6px; font-size:11px; font-weight:bold; color:#4f46e5; background:#eff6ff;">
                                    <option value="TRY">â‚º TRY</option>
                                    <option value="USD">$ USD</option>
                                    <option value="EUR">â‚¬ EUR</option>
                                </select>
                            </div>
                            <div class="chart-controls">
                                <button class="time-btn" onclick="accounting.filterChartDate('24h', this)">24S</button>
                                <button class="time-btn active" onclick="accounting.filterChartDate('1w', this)">1H</button>
                                <button class="time-btn" onclick="accounting.filterChartDate('1m', this)">1A</button>
                                <button class="time-btn" onclick="accounting.filterChartDate('1y', this)">1Y</button>
                                <button class="time-btn" onclick="accounting.filterChartDate('all', this)">TÃœM</button>
                            </div>
                        </div>
                        <div style="height: 320px; width: 100%; position:relative;"><canvas id="financeChart"></canvas></div>
                    </div>

                   <div class="card card-visible" style="padding:0; display:flex; flex-direction:column;">
                        
                        <div style="padding:20px; border-bottom:1px solid #f1f5f9; display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-weight:700; color:#64748b; font-size:13px;">SON Ä°ÅžLEMLER VE HAREKETLER</span>
                            
                            <div style="display:flex; gap:10px;">
                                <div class="filter-wrapper">
                                    <button class="btn-filter" onclick="accounting.toggleFilterMenu()">
                                        <span class="material-icons-round">filter_list</span> Filtrele
                                    </button>
                                    <div class="filter-dropdown" id="filter-menu">
                                        <div class="filter-row">
                                            <span class="filter-label">Ä°ÅŸlem TÃ¼rÃ¼</span>
                                            <select class="form-control" id="f-type">
                                                <option value="all">TÃ¼mÃ¼</option>
                                                <option value="income">Gelirler</option>
                                                <option value="expense">Giderler</option>
                                                <option value="escrow">Emanetler</option>
                                            </select>
                                        </div>
                                        <div class="filter-row">
                                            <span class="filter-label">Para Birimi</span>
                                            <select class="form-control" id="f-currency">
                                                <option value="all">TÃ¼mÃ¼</option>
                                                <option value="TRY">TRY</option>
                                                <option value="USD">USD</option>
                                                <option value="EUR">EUR</option>
                                            </select>
                                        </div>
                                        <div class="filter-row">
                                            <span class="filter-label">Tutar AralÄ±ÄŸÄ±</span>
                                            <div style="display:flex; gap:5px;">
                                                <input type="number" class="form-control" id="f-min" placeholder="Min">
                                                <input type="number" class="form-control" id="f-max" placeholder="Max">
                                            </div>
                                        </div>
                                        <button class="btn btn-blue" style="width:100%;" onclick="accounting.applyFilters()">Uygula</button>
                                    </div>
                                </div>

                                <button class="btn-filter" onclick="accounting.refreshDashboard()">
                                    <span class="material-icons-round">refresh</span> Yenile
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="data-table" style="margin:0;">
                                <tbody id="transactions-body"><tr><td colspan="4" style="text-align:center; padding:20px;">YÃ¼kleniyor...</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <section id="section-crm" class="content-section" style="display:none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                    <div><h1 style="margin:0; font-size:24px;">Operasyon</h1></div>
                    <button class="btn btn-blue" onclick="ui.openModal('modal-select-income-type')" style="width:auto;">YENÄ° DOSYA</button>
                </div>
                <div class="crm-filter-bar">
                    <div class="filter-tab active" onclick="crm.filterList('all')">TÃ¼mÃ¼ <span class="count-badge" id="count-all">0</span></div>
                    <div class="filter-tab" onclick="crm.filterList('new')">Yeni <span class="count-badge bg-blue" id="count-new">0</span></div>
                    <div class="filter-tab" onclick="crm.filterList('docs_wait')">Evrak <span class="count-badge bg-orange" id="count-docs">0</span></div>
                    <div class="filter-tab" onclick="crm.filterList('appointment_wait')">Randevu <span class="count-badge bg-red" id="count-app-wait">0</span></div>
                    <div class="filter-tab" onclick="crm.filterList('process')">Ä°ÅŸlemde <span class="count-badge bg-purple" id="count-process">0</span></div>
                </div>
                <div class="card" style="padding:0; overflow:hidden;">
                    <div class="table-container"><table class="crm-table"><thead><tr><th style="padding-left:25px;">MÃ¼ÅŸteri</th><th>Hedef</th><th>Durum</th><th>Tarih</th><th></th></tr></thead><tbody id="crm-table-body"></tbody></table></div>
                </div>
            </section>
        </main>
    </div>

    <div class="modal-overlay" id="modal-select-income-type">
        <div class="modal-box" style="width: 750px;">
            <div class="modal-header">
                <h3>Ä°ÅŸlem TÃ¼rÃ¼nÃ¼ SeÃ§iniz</h3>
                <button class="close-btn" onclick="ui.closeModal('modal-select-income-type')"><span class="material-icons-round">close</span></button>
            </div>
            <div class="modal-body" style="background: #f8fafc;">
                <div class="income-selection-grid">
                    <div class="income-card theme-visa" onclick="ui.closeModal('modal-select-income-type'); ui.openModal('modal-income');">
                        <div class="income-icon-box"><span class="material-icons-round">post_add</span></div>
                        <div class="income-content"><div class="income-title">VÄ°ZE DOSYASI</div><div class="income-desc">Yeni baÅŸvuru oluÅŸtur</div></div>
                    </div>
                    <div class="income-card theme-extra" onclick="ui.closeModal('modal-select-income-type'); ui.openModal('modal-extra-income');">
                        <div class="income-icon-box"><span class="material-icons-round">airplane_ticket</span></div>
                        <div class="income-content"><div class="income-title">EK HÄ°ZMET</div><div class="income-desc">UÃ§ak, Sigorta, Otel</div></div>
                    </div>
                    <div class="income-card theme-escrow" onclick="ui.closeModal('modal-select-income-type'); ui.openModal('modal-escrow');">
                        <div class="income-icon-box"><span class="material-icons-round">account_balance_wallet</span></div>
                        <div class="income-content"><div class="income-title">EMANET</div><div class="income-desc">GeÃ§ici para giriÅŸi</div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

 <div class="modal-overlay" id="modal-income">
        <div class="modal-box" style="width: 950px; max-height: 95vh;">
            <div class="modal-header" style="background: #fff; border-bottom: none; padding-bottom: 0;">
                <h3 style="font-size: 18px; color: #1e293b;">Yeni Vize DosyasÄ±</h3>
                <button class="close-btn" onclick="ui.closeModal('modal-income')"><span class="material-icons-round">close</span></button>
            </div>
            
            <div style="padding: 10px 40px; background: #fff;">
                <div class="wizard-header">
                    <div class="wizard-step active" id="ws-1" onclick="crm.goToStep(1)"><div class="step-icon-box"><span class="material-icons-round">person</span></div><div class="step-title">KÄ°MLÄ°K</div></div>
                    <div class="wizard-step" id="ws-2" onclick="crm.goToStep(2)"><div class="step-icon-box"><span class="material-icons-round">flight_takeoff</span></div><div class="step-title">SEYAHAT</div></div>
                    <div class="wizard-step" id="ws-3" onclick="crm.goToStep(3)"><div class="step-icon-box"><span class="material-icons-round">folder_open</span></div><div class="step-title">EVRAK</div></div>
                    <div class="wizard-step" id="ws-4" onclick="crm.goToStep(4)"><div class="step-icon-box"><span class="material-icons-round">account_balance</span></div><div class="step-title">FÄ°NANS</div></div>
                </div>
            </div>

            <div class="modal-body" style="background: #f8fafc; padding: 30px;">
                <form id="form-visa-wizard">
                    
                    <div class="wizard-page" id="step-1">
                        <div style="background: white; padding: 25px; border-radius: 16px; border: 1px solid #e2e8f0;">
                            <div class="form-row"><div class="form-group half"><label>AdÄ±</label><input type="text" class="form-control" id="v-name" required></div><div class="form-group half"><label>SoyadÄ±</label><input type="text" class="form-control" id="v-surname" required></div></div>
                            <div class="form-row"><div class="form-group half"><label>Pasaport No</label><input type="text" class="form-control" id="v-passport" required></div><div class="form-group half"><label>TC Kimlik</label><input type="text" class="form-control" id="v-tcid"></div></div>
                            <div class="form-row"><div class="form-group half"><label>Telefon</label><input type="tel" class="form-control" id="v-phone" required></div><div class="form-group half"><label>Meslek</label><input type="text" class="form-control" id="v-job"></div></div>
                        </div>
                        <div style="text-align:right; margin-top:20px;"><button type="button" class="btn btn-blue" style="width:auto; padding: 12px 30px;" onclick="window.crm.goToStep(2)">Ä°LERÄ° &rarr;</button></div>
                    </div>

                    <div class="wizard-page" id="step-2" style="display:none;">
                        <div style="background: white; padding: 25px; border-radius: 16px; border: 1px solid #e2e8f0;">
                            <div class="form-row"><div class="form-group half"><label>Gidilecek Ãœlke</label><select class="form-control" id="v-country"><option value="" disabled selected>Ãœlke SeÃ§iniz...</option><optgroup label="PopÃ¼ler"><option value="DE">Almanya</option><option value="FR">Fransa</option><option value="US">ABD</option><option value="GB">Ä°ngiltere</option><option value="NL">Hollanda</option></optgroup><optgroup label="DiÄŸer"><option value="IT">Ä°talya</option><option value="ES">Ä°spanya</option><option value="CA">Kanada</option><option value="AE">Dubai</option><option value="RU">Rusya</option><option value="CN">Ã‡in</option></optgroup></select></div><div class="form-group half"><label>Vize Tipi</label><select class="form-control" id="v-type" onchange="crm.updateDocList()"><option value="tourist">Turistik</option><option value="commercial">Ticari / Fuar</option><option value="family">Aile Ziyareti</option><option value="student">EÄŸitim / Ã–ÄŸrenci</option><option value="seaman">Gemi AdamÄ±</option><option value="vip">VIP / Express</option><option value="medical">SaÄŸlÄ±k</option></select></div></div>
                            <div class="form-row"><div class="form-group half"><label>GidiÅŸ</label><input type="date" class="form-control" id="v-start"></div><div class="form-group half"><label>DÃ¶nÃ¼ÅŸ</label><input type="date" class="form-control" id="v-end"></div></div>
                            <div id="dynamic-inputs"></div>
                        </div>
                        <div style="display:flex; justify-content:space-between; margin-top:20px;"><button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(1)">&larr; GERÄ°</button><button type="button" class="btn btn-blue" style="width:auto; padding: 12px 30px;" onclick="window.crm.goToStep(3)">Ä°LERÄ° &rarr;</button></div>
                    </div>

                    <div class="wizard-page" id="step-3" style="display:none;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h4 style="margin:0; font-size:14px; color:#64748b;">Gerekli Evrak Listesi</h4>
                            <button type="button" class="btn-dashed" style="width: auto; padding: 8px 15px;" onclick="crm.addManualDoc()"><span class="material-icons-round" style="font-size:16px;">add</span> Dosya Ekle</button>
                        </div>
                        <div class="doc-grid" id="doc-list-container"></div>
                        <div style="display:flex; justify-content:space-between; margin-top:20px;"><button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(2)">&larr; GERÄ°</button><button type="button" class="btn btn-blue" style="width:auto; padding: 12px 30px;" onclick="window.crm.goToStep(4)">Ä°LERÄ° &rarr;</button></div>
                    </div>

                    <div class="wizard-page" id="step-4" style="display:none;">
                        <div class="finance-summary">
                            <div class="fin-box"><div class="fin-label">TOPLAM ANLAÅžMA</div><div class="fin-amount text-blue" id="disp-total">0 â‚º</div></div>
                            <div class="fin-box"><div class="fin-label">TAHSÄ°LAT (ALINAN)</div><div class="fin-amount text-green" id="disp-paid">0 â‚º</div></div>
                            <div class="fin-box"><div class="fin-label">KALAN BAKÄ°YE</div><div class="fin-amount text-red" id="disp-remain">0 â‚º</div></div>
                        </div>

                        <div style="background: white; padding: 25px; border-radius: 16px; border: 1px solid #e2e8f0; margin-bottom: 20px;">
                            <div class="form-row"><div class="form-group half"><label>Toplam Tutar</label><input type="number" class="form-control" id="v-total-price" placeholder="5000" oninput="crm.calcFinance()"></div><div class="form-group half"><label>PeÅŸinat (Åžimdi AlÄ±nan)</label><input type="number" class="form-control" id="v-paid-now" placeholder="0" oninput="crm.calcFinance()"></div><div class="form-group" style="width:100px;"><label>Birim</label><select class="form-control" id="v-currency" onchange="crm.calcFinance()"><option>TRY</option><option>USD</option><option>EUR</option></select></div></div>
                        </div>

                        <div class="form-group" style="background:#fff7ed; padding:15px; border-radius:10px; border:1px solid #ffedd5;">
                            <label style="color:#ea580c; font-weight:800; margin-bottom:10px; display:block; font-size: 13px;">OPERASYON GÄ°DERLERÄ° (EMANET)</label>
                            <div class="expense-row"><div style="display:flex; align-items:center; gap:10px;"><input type="checkbox" id="chk-fee"><span>Konsolosluk / BaÅŸvuru HarcÄ±</span><span class="badge-escrow">EMANET</span></div><input type="number" id="v-fee-amount" class="form-control" style="width:120px; height:35px;" placeholder="Tutar"></div>
                            <div class="expense-row"><div style="display:flex; align-items:center; gap:10px;"><input type="checkbox" id="chk-ins"><span>Seyahat SaÄŸlÄ±k SigortasÄ±</span></div><input type="number" id="v-ins-amount" class="form-control" style="width:120px; height:35px;" placeholder="Tutar"></div>
                        </div>

                        <div style="display:flex; justify-content:space-between; margin-top:20px;">
                            <button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(3)">&larr; GERÄ°</button>
                            <button type="submit" class="btn btn-green" style="width:auto; padding: 12px 40px; font-size: 16px;">KAYDET VE BÄ°TÄ°R</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
            
            <div style="padding: 20px 40px 0; background: #fff;">
                <div class="wizard-header">
                    <div class="wizard-step active" id="ws-1" onclick="crm.goToStep(1)"><div class="step-icon-box"><span class="material-icons-round">person</span></div><div class="step-title">KÄ°MLÄ°K</div></div>
                    <div class="wizard-step" id="ws-2" onclick="crm.goToStep(2)"><div class="step-icon-box"><span class="material-icons-round">flight_takeoff</span></div><div class="step-title">SEYAHAT</div></div>
                    <div class="wizard-step" id="ws-3" onclick="crm.goToStep(3)"><div class="step-icon-box"><span class="material-icons-round">folder_open</span></div><div class="step-title">EVRAK</div></div>
                    <div class="wizard-step" id="ws-4" onclick="crm.goToStep(4)"><div class="step-icon-box"><span class="material-icons-round">payments</span></div><div class="step-title">FÄ°NANS</div></div>
                </div>
            </div>

            <div class="modal-body">
                <form id="form-visa-wizard">
                    
                    <div class="wizard-page" id="step-1">
                        <div class="form-row"><div class="form-group half"><label>AdÄ±</label><input type="text" class="form-control" id="v-name" required></div><div class="form-group half"><label>SoyadÄ±</label><input type="text" class="form-control" id="v-surname" required></div></div>
                        <div class="form-row"><div class="form-group half"><label>Pasaport No</label><input type="text" class="form-control" id="v-passport" required></div><div class="form-group half"><label>TC Kimlik</label><input type="text" class="form-control" id="v-tcid"></div></div>
                        <div class="form-row"><div class="form-group half"><label>Telefon</label><input type="tel" class="form-control" id="v-phone" required></div><div class="form-group half"><label>Meslek</label><input type="text" class="form-control" id="v-job"></div></div>
                        <div style="text-align:right; margin-top:20px;"><button type="button" class="btn btn-blue" style="width:auto;" onclick="window.crm.goToStep(2)">Ä°LERÄ° &rarr;</button></div>
                    </div>

                    <div class="wizard-page" id="step-2" style="display:none;">
                        <div class="form-row">
                            <div class="form-group half">
                                <label>Gidilecek Ãœlke</label>
                                <select class="form-control" id="v-country">
                                    <option value="" disabled selected>Ãœlke SeÃ§iniz...</option>
                                    <optgroup label="PopÃ¼ler">
                                        <option value="DE">Almanya</option><option value="FR">Fransa</option><option value="US">ABD</option><option value="GB">Ä°ngiltere</option><option value="NL">Hollanda</option><option value="IT">Ä°talya</option><option value="ES">Ä°spanya</option><option value="CA">Kanada</option>
                                    </optgroup>
                                    <optgroup label="DiÄŸer">
                                        <option value="AT">Avusturya</option><option value="BE">BelÃ§ika</option><option value="BG">Bulgaristan</option><option value="CZ">Ã‡ekya</option><option value="CN">Ã‡in</option><option value="DK">Danimarka</option><option value="FI">Finlandiya</option><option value="GR">Yunanistan</option><option value="HU">Macaristan</option><option value="IE">Ä°rlanda</option><option value="JP">Japonya</option><option value="NO">NorveÃ§</option><option value="PL">Polonya</option><option value="PT">Portekiz</option><option value="RO">Romanya</option><option value="RU">Rusya</option><option value="SE">Ä°sveÃ§</option><option value="CH">Ä°sviÃ§re</option><option value="AE">Dubai (BAE)</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group half">
                                <label>Vize Tipi</label>
                                <select class="form-control" id="v-type" onchange="crm.updateDocList()">
                                    <option value="tourist">Turistik</option>
                                    <option value="commercial">Ticari / Fuar</option>
                                    <option value="family">Aile Ziyareti</option>
                                    <option value="student">EÄŸitim / Ã–ÄŸrenci</option>
                                    <option value="seaman">Gemi AdamÄ±</option>
                                    <option value="vip">VIP / Express</option>
                                    <option value="medical">SaÄŸlÄ±k</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row"><div class="form-group half"><label>GidiÅŸ</label><input type="date" class="form-control" id="v-start"></div><div class="form-group half"><label>DÃ¶nÃ¼ÅŸ</label><input type="date" class="form-control" id="v-end"></div></div>
                        <div id="dynamic-inputs"></div>
                        <div style="display:flex; justify-content:space-between; margin-top:20px;"><button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(1)">&larr; GERÄ°</button><button type="button" class="btn btn-blue" style="width:auto;" onclick="window.crm.goToStep(3)">Ä°LERÄ° &rarr;</button></div>
                    </div>

                    <div class="wizard-page" id="step-3" style="display:none;">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                            <h4 style="margin:0; font-size:14px; color:#64748b;">Gerekli Evrak Listesi</h4>
                            <button type="button" class="btn-sm" style="background:#eff6ff; color:#2563eb; border:1px solid #dbeafe; cursor:pointer;" onclick="crm.addManualDoc()">
                                <span class="material-icons-round" style="font-size:16px;">add</span> Dosya Ekle
                            </button>
                        </div>
                        <div class="doc-grid" id="doc-list-container"></div>
                        <div style="display:flex; justify-content:space-between; margin-top:20px;"><button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(2)">&larr; GERÄ°</button><button type="button" class="btn btn-blue" style="width:auto;" onclick="window.crm.goToStep(4)">Ä°LERÄ° &rarr;</button></div>
                    </div>

                    <div class="wizard-page" id="step-4" style="display:none;">
                        <div class="finance-summary">
                            <div class="fin-box"><div class="fin-label">Toplam Tutar</div><div class="fin-amount text-blue" id="disp-total">0 â‚º</div></div>
                            <div class="fin-box"><div class="fin-label">AlÄ±nan (Kasa)</div><div class="fin-amount text-green" id="disp-paid">0 â‚º</div></div>
                            <div class="fin-box"><div class="fin-label">Kalan BorÃ§</div><div class="fin-amount text-red" id="disp-remain">0 â‚º</div></div>
                        </div>

                        <div class="form-row">
                            <div class="form-group half">
                                <label>MÃ¼ÅŸteriyle AnlaÅŸÄ±lan Tutar</label>
                                <div style="display:flex; gap:10px;">
                                    <input type="number" class="form-control" id="v-total-price" placeholder="5000" oninput="crm.calcFinance()">
                                    <select class="form-control" style="width:100px;" id="v-currency" onchange="crm.calcFinance()"><option>TRY</option><option>USD</option><option>EUR</option></select>
                                </div>
                            </div>
                            <div class="form-group half">
                                <label>PeÅŸinat (Åžimdi AlÄ±nan)</label>
                                <input type="number" class="form-control" id="v-paid-now" placeholder="0" oninput="crm.calcFinance()">
                            </div>
                        </div>

                        <div class="form-group" style="background:#fff7ed; padding:15px; border-radius:10px; border:1px solid #ffedd5;">
                            <label style="color:#ea580c; font-weight:700; margin-bottom:10px; display:block;">Operasyonel Giderler (Emanet)</label>
                            
                            <div class="expense-row">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="checkbox" id="chk-fee">
                                    <span>Konsolosluk / BaÅŸvuru HarcÄ±</span>
                                    <span class="badge-escrow">EMANET</span>
                                </div>
                                <input type="number" id="v-fee-amount" class="form-control" style="width:100px; height:30px;" placeholder="Tutar">
                            </div>

                            <div class="expense-row">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <input type="checkbox" id="chk-ins">
                                    <span>Seyahat SaÄŸlÄ±k SigortasÄ±</span>
                                </div>
                                <input type="number" id="v-ins-amount" class="form-control" style="width:100px; height:30px;" placeholder="Tutar">
                            </div>
                        </div>

                        <div style="display:flex; justify-content:space-between; margin-top:20px;">
                            <button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(3)">&larr; GERÄ°</button>
                            <button type="submit" class="btn btn-green" style="width:auto;">DOSYAYI OLUÅžTUR</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
            <div style="padding: 20px 40px 0; background: #fff;">
                <div class="wizard-header">
                    <div class="wizard-step active" id="ws-1" onclick="crm.goToStep(1)"><div class="step-icon-box"><span class="material-icons-round">person</span></div><div class="step-title">KÄ°MLÄ°K</div></div>
                    <div class="wizard-step" id="ws-2" onclick="crm.goToStep(2)"><div class="step-icon-box"><span class="material-icons-round">flight_takeoff</span></div><div class="step-title">SEYAHAT</div></div>
                    <div class="wizard-step" id="ws-3" onclick="crm.goToStep(3)"><div class="step-icon-box"><span class="material-icons-round">folder_open</span></div><div class="step-title">EVRAK</div></div>
                    <div class="wizard-step" id="ws-4" onclick="crm.goToStep(4)"><div class="step-icon-box"><span class="material-icons-round">payments</span></div><div class="step-title">FÄ°NANS</div></div>
                </div>
            </div>
            <div class="modal-body">
                <form id="form-visa-wizard">
                    <div class="wizard-page" id="step-1">
                        <div class="form-row"><div class="form-group half"><label>AdÄ±</label><input type="text" class="form-control" id="v-name" required></div><div class="form-group half"><label>SoyadÄ±</label><input type="text" class="form-control" id="v-surname" required></div></div>
                        <div class="form-row"><div class="form-group half"><label>Pasaport No</label><input type="text" class="form-control" id="v-passport" required></div><div class="form-group half"><label>TC Kimlik</label><input type="text" class="form-control" id="v-tcid"></div></div>
                        <div class="form-row"><div class="form-group half"><label>Telefon</label><input type="tel" class="form-control" id="v-phone" required></div><div class="form-group half"><label>Meslek</label><input type="text" class="form-control" id="v-job"></div></div>
                        <div style="text-align:right; margin-top:20px;"><button type="button" class="btn btn-blue" style="width:auto;" onclick="window.crm.goToStep(2)">Ä°LERÄ° &rarr;</button></div>
                    </div>
                    <div class="wizard-page" id="step-2" style="display:none;">
                        <div class="form-row"><div class="form-group half"><label>Ãœlke</label><select class="form-control" id="v-country"><option value="DE">Almanya</option><option value="FR">Fransa</option><option value="US">ABD</option></select></div><div class="form-group half"><label>Vize Tipi</label><select class="form-control" id="v-type" onchange="crm.updateDocList()"><option value="tourist">Turistik</option><option value="commercial">Ticari</option><option value="seaman">Gemi AdamÄ±</option></select></div></div>
                        <div class="form-row"><div class="form-group half"><label>GidiÅŸ</label><input type="date" class="form-control" id="v-start"></div><div class="form-group half"><label>DÃ¶nÃ¼ÅŸ</label><input type="date" class="form-control" id="v-end"></div></div>
                        <div id="dynamic-inputs"></div>
                        <div style="display:flex; justify-content:space-between; margin-top:20px;"><button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(1)">&larr; GERÄ°</button><button type="button" class="btn btn-blue" style="width:auto;" onclick="window.crm.goToStep(3)">Ä°LERÄ° &rarr;</button></div>
                    </div>
                    <div class="wizard-page" id="step-3" style="display:none;">
                        <div class="doc-grid" id="doc-list-container"></div>
                        <div style="display:flex; justify-content:space-between; margin-top:20px;"><button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(2)">&larr; GERÄ°</button><button type="button" class="btn btn-blue" style="width:auto;" onclick="window.crm.goToStep(4)">Ä°LERÄ° &rarr;</button></div>
                    </div>
                    <div class="wizard-page" id="step-4" style="display:none;">
                        <div class="finance-summary"><div class="fin-box"><div class="fin-label">Tutar</div><div class="fin-amount text-blue" id="disp-total">0</div></div><div class="fin-box"><div class="fin-label">AlÄ±nan</div><div class="fin-amount text-green" id="disp-paid">0</div></div><div class="fin-box"><div class="fin-label">Kalan</div><div class="fin-amount text-red" id="disp-remain">0</div></div></div>
                        <div class="form-row"><div class="form-group half"><label>Toplam Tutar</label><input type="number" class="form-control" id="v-total-price" oninput="crm.calcFinance()"></div><div class="form-group half"><label>PeÅŸinat</label><input type="number" class="form-control" id="v-paid-now" oninput="crm.calcFinance()"></div></div>
                        <div style="display:flex; justify-content:space-between; margin-top:20px;"><button type="button" class="btn" style="background:#e2e8f0; color:#334155; width:auto;" onclick="window.crm.goToStep(3)">&larr; GERÄ°</button><button type="submit" class="btn btn-green" style="width:auto;">KAYDET</button></div>
                    </div>
                </form>
            </div>
        </div>
    </div>

   <div class="modal-overlay" id="modal-extra-income">
        <div class="modal-box" style="width: 650px;">
            <div class="modal-header"><h3>Ek Hizmet Geliri</h3><button class="close-btn" onclick="ui.closeModal('modal-extra-income')"><span class="material-icons-round">close</span></button></div>
            <div class="modal-body">
                <form id="form-extra-income">
                    <div class="form-group"><label>MÃ¼ÅŸteri</label><input type="text" class="form-control" id="ei-customer" required></div>
                    <div class="form-group"><label>Hizmet</label>
                        <select class="form-control" id="ei-category">
                            <optgroup label="SEYAHAT"><option value="flight_ticket">UÃ§ak Bileti</option><option value="hotel_booking">Otel Rezervasyonu</option><option value="transfer">Transfer</option></optgroup>
                            <optgroup label="SÄ°GORTA"><option value="travel_insurance">Seyahat SigortasÄ±</option><option value="health_insurance">YabancÄ± SaÄŸlÄ±k SigortasÄ±</option></optgroup>
                            <optgroup label="DANIÅžMANLIK"><option value="consultancy">Vize DanÄ±ÅŸmanlÄ±ÄŸÄ±</option><option value="citizenship">VatandaÅŸlÄ±k Ä°ÅŸlemleri</option><option value="residence">Oturum Ä°zni</option></optgroup>
                            <option value="other">DiÄŸer Hizmet</option>
                        </select>
                    </div>
                    <div class="form-group"><label>Tutar</label><div style="display:flex; gap:10px;"><input type="number" class="form-control" id="ei-amount" required><select class="form-control" id="ei-currency" style="width:100px;"><option>TRY</option><option>USD</option><option>EUR</option></select></div></div>
                    <div class="form-group"><label>AÃ§Ä±klama</label><input type="text" class="form-control" id="ei-desc"></div>
                    <button type="submit" class="btn btn-blue">KAYDET</button>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-escrow">
        <div class="modal-box" style="width: 650px;">
            <div class="modal-header"><h3>ðŸŸ  Emanet GiriÅŸi</h3><button class="close-btn" onclick="ui.closeModal('modal-escrow')"><span class="material-icons-round">close</span></button></div>
            <div class="modal-body">
                <form id="form-escrow">
                    <div class="form-row"><div class="form-group half"><label>MÃ¼ÅŸteri</label><input type="text" class="form-control" id="esc-customer" required></div><div class="form-group half"><label>TÃ¼r</label><select class="form-control" id="esc-category"><option value="consulate">Konsolosluk</option><option value="other">DiÄŸer</option></select></div></div>
                    <div class="form-group"><label>Tutar</label><div style="display:flex; gap:10px;"><input type="number" class="form-control" id="esc-amount" required><select class="form-control" id="esc-currency" style="width:100px;"><option>EUR</option><option>USD</option><option>TRY</option></select></div></div>
                    <div class="form-row"><div class="form-group half"><label>Tarih</label><input type="date" class="form-control" id="esc-date"></div><div class="form-group half"><label>Not</label><input type="text" class="form-control" id="esc-desc"></div></div>
                    <button type="submit" class="btn btn-orange">EMANETÄ° KASAYA AL</button>
                </form>
            </div>
        </div>
    </div>

   <div class="modal-overlay" id="modal-expense">
        <div class="modal-box">
            <div class="modal-header"><h3>Gider Ekle</h3><button class="close-btn" onclick="ui.closeModal('modal-expense')"><span class="material-icons-round">close</span></button></div>
            <div class="modal-body">
                <form id="form-expense">
                    <div class="form-group">
                        <label>Gider BaÅŸlÄ±ÄŸÄ± / Konu</label>
                        <input type="text" class="form-control" id="exp-title" placeholder="Ã–rn: Ofis KirasÄ±, Mutfak AlÄ±ÅŸveriÅŸi..." required>
                    </div>
                    <div class="form-group">
                        <label>Kategori</label>
                        <select class="form-control" id="exp-category" required>
                            <option value="" disabled selected>SeÃ§iniz...</option>
                            <optgroup label=" OFÄ°S & Ä°ÅžLETME">
                                <option value="rent">Kira / Aidat</option>
                                <option value="bills">Fatura (Elektrik/Su/Ä°nternet)</option>
                                <option value="office_supplies">KÄ±rtasiye / Sarf Malzeme</option>
                                <option value="cleaning">Temizlik / BakÄ±m</option>
                            </optgroup>
                            <optgroup label=" PERSONEL">
                                <option value="salary">MaaÅŸ Ã–demesi</option>
                                <option value="bonus">Prim / Avans</option>
                                <option value="food">Yemek / Yol</option>
                                <option value="sgk">SGK / Vergi</option>
                            </optgroup>
                            <optgroup label=" OPERASYONEL">
                                <option value="courier">Kargo / Kurye</option>
                                <option value="consultancy">DÄ±ÅŸ DanÄ±ÅŸmanlÄ±k</option>
                                <option value="transport">UlaÅŸÄ±m / Transfer</option>
                            </optgroup>
                            <optgroup label=" PAZARLAMA">
                                <option value="marketing_digital">Google / Instagram Reklam</option>
                                <option value="marketing_print">Tabela / BroÅŸÃ¼r</option>
                                <option value="software">YazÄ±lÄ±m / Web Sitesi</option>
                            </optgroup>
                            <option value="other">DiÄŸer (Genel)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Tutar</label>
                        <div style="display:flex; gap:10px;">
                            <input type="number" class="form-control" id="exp-amount" required>
                            <select class="form-control" style="width:100px;" id="exp-currency"><option>TRY</option><option>USD</option><option>EUR</option></select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-red">KAYDET</button>
                </form>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-transaction-detail">
        <div class="modal-box" style="width: 500px;">
            <div class="modal-header">
                <h3>Ä°ÅŸlem FiÅŸi</h3>
                <button class="close-btn" onclick="ui.closeModal('modal-transaction-detail')"><span class="material-icons-round">close</span></button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <div class="receipt-header">
                    <div style="font-size:12px; color:#94a3b8; font-weight:600;">Ä°ÅžLEM TUTARI</div>
                    <div class="receipt-amount" id="td-amount">-</div>
                    <div class="badge badge-gray" id="td-cat">Kategori</div>
                </div>
                <div class="receipt-grid">
                    <div class="receipt-item"><label>Ä°ÅŸlem Tarihi</label><span id="td-date">-</span></div>
                    <div class="receipt-item"><label>Ä°ÅŸlem ID</label><span id="td-id" style="font-family:monospace; font-size:12px;">-</span></div>
                </div>
                <div class="receipt-item" style="margin-top:15px;"><label>AÃ§Ä±klama</label><span id="td-desc" style="line-height:1.5;">-</span></div>
                <div class="receipt-item" style="margin-top:20px; background:#f8fafc; padding:15px; border-radius:10px;">
                    <label style="margin-bottom:5px;">Ä°ÅŸlemi Yapan Yetkili</label>
                    <div class="user-badge"><div class="user-avatar">EK</div><span id="td-user">Ebubekir KÄ±zÄ±ldaÅŸ</span></div>
                </div>
                <div style="margin-top:25px; text-align:center;">
                    <button class="btn btn-red" style="width:100%; opacity:0.8;" onclick="accounting.deleteTransaction()"><span class="material-icons-round">delete</span> BU KAYDI SÄ°L</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="modal-exchange">
        <div class="modal-box"><div class="modal-header"><h3>ðŸ’± Kur DÃ¶nÃ¼ÅŸÃ¼mÃ¼</h3><button class="close-btn" onclick="ui.closeModal('modal-exchange')"><span class="material-icons-round">close</span></button></div>
        <div class="modal-body"><form id="form-exchange"><div class="form-group"><label>Bozulacak</label><div style="display:flex; gap:10px;"><input type="number" class="form-control" id="ex-amount-out" required><select class="form-control" style="width:100px;" id="ex-currency-out"><option value="USD">USD</option><option value="EUR">EUR</option></select></div></div><div class="form-group"><label>AlÄ±nan (Net)</label><div style="display:flex; gap:10px;"><input type="number" class="form-control" id="ex-amount-in" required><select class="form-control" style="width:100px;" id="ex-currency-in"><option value="TRY">TRY</option></select></div></div><div class="form-group"><label>Not</label><input type="text" class="form-control" id="ex-desc"></div><button type="submit" class="btn btn-blue">KAYDET</button></form></div></div>
    </div>

   <div class="modal-overlay" id="modal-escrow-details">
        <div class="modal-box" style="width: 800px;">
            <div class="modal-header">
                <h3>ðŸŸ  Emanet Havuzu</h3>
                <button class="close-btn" onclick="ui.closeModal('modal-escrow-details')"><span class="material-icons-round">close</span></button>
            </div>
            <div class="modal-body" style="padding: 25px; background: #f8fafc;">
                
                <div class="escrow-grid-premium">
                    <div class="escrow-card bg-eur">
                        <span class="material-icons-round esc-icon">euro</span>
                        <div class="esc-label">EUR BAKÄ°YE</div>
                        <div class="esc-amount" id="esc-total-eur">â‚¬ 0,00</div>
                    </div>
                    <div class="escrow-card bg-usd">
                        <span class="material-icons-round esc-icon">attach_money</span>
                        <div class="esc-label">USD BAKÄ°YE</div>
                        <div class="esc-amount" id="esc-total-usd">$ 0,00</div>
                    </div>
                    <div class="escrow-card bg-try">
                        <span class="material-icons-round esc-icon">currency_lira</span>
                        <div class="esc-label">TL BAKÄ°YE</div>
                        <div class="esc-amount" id="esc-total-try">â‚º 0,00</div>
                    </div>
                </div>

                <div style="background: white; border-radius: 12px; border: 1px solid #e2e8f0; overflow: hidden;">
                    <div style="padding: 15px; border-bottom: 1px solid #f1f5f9; font-weight: 700; color: #64748b; font-size: 13px;">
                        SON HAREKETLER (Ä°ÅŸlem yapmak iÃ§in satÄ±ra Ã§ift tÄ±kla)
                    </div>
                    <div class="table-container" style="max-height: 300px; overflow-y: auto;">
                        <table class="data-table" style="margin:0;">
                            <thead><tr><th>Tarih</th><th>AÃ§Ä±klama / MÃ¼ÅŸteri</th><th>Tutar</th><th>Durum</th></tr></thead>
                            <tbody id="escrow-list-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-escrow-action">
        <div class="modal-box" style="width: 500px;">
            <div class="modal-header">
                <h3>Emanet Ã‡Ä±kÄ±ÅŸÄ± / Ä°ade</h3>
                <button class="close-btn" onclick="ui.closeModal('modal-escrow-action')"><span class="material-icons-round">close</span></button>
            </div>
            <div class="modal-body" style="padding: 25px;">
                
                <div style="background: #fff7ed; padding: 15px; border-radius: 10px; border: 1px solid #ffedd5; margin-bottom: 20px;">
                    <div style="font-size: 12px; color: #ea580c; font-weight: 700;">Ä°ÅžLEM YAPILACAK KAYIT</div>
                    <div id="act-source-desc" style="font-weight: 600; margin-top: 5px; color: #1e293b;">...</div>
                    <div id="act-source-amount" style="font-size: 18px; font-weight: 800; color: #ea580c; margin-top: 5px;">...</div>
                </div>

                <form id="form-escrow-action">
                    <input type="hidden" id="act-source-id"> <div class="form-group">
                        <label>YapÄ±lacak Ä°ÅŸlem</label>
                        <select class="form-control" id="act-type" required>
                            <option value="refund">MÃ¼ÅŸteriye Ä°ade Et (Para Ã‡Ä±kÄ±ÅŸÄ±)</option>
                            <option value="payment">Hizmet/Konsolosluk Ã–demesi Yap</option>
                            <option value="transfer">Åžirket KasasÄ±na Aktar (Gelir Yaz)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Ã‡Ä±kÄ±ÅŸ TutarÄ±</label>
                        <div style="display: flex; gap: 10px;">
                            <input type="number" class="form-control" id="act-amount" required>
                            <input type="text" class="form-control" id="act-currency" readonly style="width: 80px; background: #f1f5f9;">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>AÃ§Ä±klama</label>
                        <input type="text" class="form-control" id="act-desc" placeholder="Ã–rn: Konsolosluk harcÄ± Ã¶dendi" required>
                    </div>

                    <button type="submit" class="btn btn-orange" style="width: 100%;">Ä°ÅžLEMÄ° ONAYLA</button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="drawer-overlay" id="customer-drawer" onclick="crm.closeDrawer()"></div>
    <div class="drawer-panel" id="drawer-content"><div class="drawer-header"><h2 id="d-name">...</h2><button class="close-btn" onclick="crm.closeDrawer()"><span class="material-icons-round">close</span></button></div><div class="drawer-body"><div style="text-align:center;"><h3 id="drawer-customer-name">...</h3><p id="drawer-passport" style="color:#666;">...</p><div id="drawer-status-badge"></div></div><div class="drawer-tabs"><div class="d-tab active" onclick="crm.switchDrawerTab('tab-identity')">Kimlik</div><div class="d-tab" onclick="crm.switchDrawerTab('tab-passport')">Pasaport</div><div class="d-tab" onclick="crm.switchDrawerTab('tab-work')">Ä°ÅŸ/Aile</div><div class="d-tab" onclick="crm.switchDrawerTab('tab-files')">Evrak</div></div><div id="tab-identity" class="drawer-tab-content active"><div class="info-grid"><div class="info-item"><label>Telefon</label><span id="d-phone">-</span></div></div></div><div class="drawer-footer"><button class="btn btn-blue" style="flex:1;">DÃœZENLE</button><button class="btn btn-red" onclick="crm.deleteVisaCase()">SÄ°L</button></div></div></div>

    <script src="js/supabase.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/accounting.js"></script>
    <script src="js/crm.js"></script>
    <script src="js/app.js"></script>
    
    <script>
        window.addEventListener('load', () => { 
            setTimeout(() => { 
                document.getElementById('loading-screen').style.display='none'; 
                document.getElementById('main-app').style.display='flex'; 
            }, 1000); 
        });
    </script>

</body>
</html>
